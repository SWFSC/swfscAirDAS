---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# swfscAirDAS

<!-- badges: start -->
[![Travis build status](https://travis-ci.com/smwoodman/swfscAirDAS.svg?branch=master)](https://travis-ci.com/smwoodman/swfscAirDAS)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/smwoodman/swfscAirDAS?branch=master&svg=true)](https://ci.appveyor.com/project/smwoodman/swfscAirDAS)
<!-- badges: end -->

Warning: swfscAirDAS is still under development! Please consult with the author (sam.woodman@noaa.gov) before using it.

This package contains functions designed for processing and analyzing aerial survey DAS data (AirDAS) generated by the Southwest Fisheries Science Center using one of the following programs: PHOCOENA, SURVEY, CARETTA, or TURTLE (such as TURTLEP or TURTLE4D). Functionality includes reading AirDAS data into a data frame, processing this data (extracting state and condition information for each AirDAS event), and summarizing sighting and effort information. Plans for future development include: generating tables summarizing the information in the AirDAS file, plotting AirDAS data, and generating files needed for doing density estimation.

## Installation

You can install `swfscAirDAS` from [GitHub](https://github.com) with:

```{r}
# install.packages("remotes")
# Install remote dependency
remotes::install_github("smwoodman/swfscDAS")

# Install package
remotes::install_github("smwoodman/swfscAirDAS")
```

## AirDAS format

`swfscAirDAS` accepts AirDAS data from several different programs, and thus in several different formats: PHOCOENA, SURVEY (in the future), CARETTA, and TURTLE. You can download PDFs describing these formats at the following links:

* [PHOCOENA data format PDF](https://github.com/smwoodman/swfscAirDAS/blob/master/inst/AirDAS_Format_PHOCOENA.pdf)
* [CARETTA data format PDF](https://github.com/smwoodman/swfscAirDAS/blob/master/inst/AirDAS_Format_CARETTA.pdf)
* [TURTLE data format PDF](https://github.com/smwoodman/swfscAirDAS/blob/master/inst/AirDAS_Format_TURTLE.pdf)

These PDFs are also included in the package; see [`airdas_format_pdf`](https://smwoodman.github.io/swfscAirDAS/reference/airdas_format_pdf.html) for more details.

## Usage

First, you must read and process the AirDAS data

```{r example}
library(swfscAirDAS)
# Get file paths of sample files included in the package
y <- system.file("airdas_sample.das", package = "swfscAirDAS")

# Read and process AirDAS file, i.e. read AirDAS data into a data frame and add info columns
y.read <- airdas_read(y)
y.proc <- airdas_process(y.read)

# Alternatively, the file path can be passed directly to airdas_process
y.proc <- airdas_process(y)
```

Note that `airdas_read` can read multiple files simultaneously

```{r}
y.read.mult <- airdas_read(c(y, y))
```

After processing, you can summarize the processed AirDAS data. There are two available methods for chopping and summarizing effort: "equallength" and "condition". The method "equallength" chops continuous effort sections into equal length effort (modeling) segments, while the method "condition" chops continuous effort sections in segments every time a condition changes. 

```{r}
# Summarize sighting information
y.sight <- airdas_sight(y.proc)

# Chop and summarize effort using "equallength" method
y.eff.randpicks <- system.file("airdas_sample_randpicks.csv", package = "swfscAirDAS")

y.eff <- airdas_effort(
  y.proc, method = "equallength", sp.codes = c("mn", "bm"),
  seg.km = 3, randpicks.load = y.eff.randpicks, 
  num.cores = 1
)
y.eff.segdata <- y.eff[[1]]
y.eff.siteinfo <- y.eff[[2]]
y.eff.randpicks <- y.eff[[3]]

# Chop and summarize effort using "condition" method
y.eff.cond <- airdas_effort(
  y.proc, method = "condition", sp.codes = c("mn", "bm"),
  seg.min.km = 0.05, num.cores = 1
)
```

You can also check that your AirDAS data has accepted formatting and values, as well as extract data from comments:

```{r, eval=FALSE}
# Check formatting
y.check <- airdas_check(y, print.transect = FALSE)

# Paste comments back together
y.comments <- airdas_comments(y.proc)

# Extract data from comments
y.comments.data <- airdas_process_comments(y.proc)
```
